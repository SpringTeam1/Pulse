<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    ðŸ”µ namespace = Mapper.java ì¸í„°íŽ˜ì´ìŠ¤ ì´ë¦„ê³¼ ë§¤í•‘ë˜ëŠ” ì´ë¦„
    BoardNoticeMapper.java ë‚´ë¶€ì˜ ë©”ì„œë“œëª…ê³¼
    ì•„ëž˜ idë“¤ì´ ì •í™•ížˆ ì¼ì¹˜í•´ì•¼ ìž‘ë™í•¨
-->
<mapper namespace="com.test.pulse.mapper.BoardNoticeMapper">

    <!-- ðŸ”µ ê³µì§€ ëª©ë¡ ì¡°íšŒ (ê³µì§€ê¸€ë§Œ) -->
    <select id="list" resultType="bndto">
        SELECT 
            bn.boardSeq,
            bn.accountId,
            ai.nickname,
            bn.title,
            bn.content,
            TO_CHAR(bn.regdate, 'YYYY-MM-DD HH24:MI:SS') AS regdate,
            bn.readCount,
            bn.boardContentTypeSeq,
            bn.attach
        FROM tblBoardNotice bn
		JOIN tblAccountInfo ai ON bn.accountId = ai.accountId
        WHERE boardContentTypeSeq = 2   <!-- ðŸ”¹ ê³µì§€ê¸€ë§Œ -->
        ORDER BY boardSeq DESC
    </select>

    <!-- ðŸ”µ ìƒì„¸ë³´ê¸° -->
    <select id="view" parameterType="int" resultType="bndto">
        SELECT 
            bn.boardSeq,
            bn.accountId,
            ai.nickname,
            bn.title,
            bn.content,
            TO_CHAR(bn.regdate, 'YYYY-MM-DD HH24:MI:SS') AS regdate,
            bn.readCount,
            bn.boardContentTypeSeq,
            bn.attach
        FROM tblBoardNotice bn
		JOIN tblAccountInfo ai ON bn.accountId = ai.accountId
        WHERE boardSeq = #{seq}
    </select>

    <!-- ðŸ”µ ê¸€ì“°ê¸° -->
    <insert id="add" parameterType="bndto">
        INSERT INTO tblBoardNotice (
            boardSeq,
            accountId,
            title,
            content,
            boardContentTypeSeq,
            attach
        )
        VALUES (
            seqBoardNotice.nextVal,
            #{accountId},
            #{title},
            #{content},
            2,              <!-- ðŸ”¹ ì´ ê²Œì‹œíŒì€ ë¬´ì¡°ê±´ ê³µì§€ê¸€ â†’ 2ë¡œ ê³ ì • -->
            #{attach}
        )
    </insert>
    
    <!-- ðŸ”µ ì¡°íšŒìˆ˜ ì¦ê°€ -->
    <update id="increaseReadCount" parameterType="int">
        UPDATE tblBoardNotice
        SET readCount = readCount + 1
        WHERE boardSeq = #{seq}
    </update>

    <!-- ðŸ”µ ìˆ˜ì • -->
    <update id="edit" parameterType="bndto">
        UPDATE tblBoardNotice
        SET 
            title = #{title},
            content = #{content},
            attach = #{attach}
        WHERE boardSeq = #{boardSeq}
    </update>

    <!-- ðŸ”µ ì‚­ì œ -->
    <delete id="del" parameterType="int">
        DELETE FROM tblBoardNotice 
        WHERE boardSeq = #{seq}
    </delete>
    
    <!-- ðŸ”µ íŽ˜ì´ì§• ëª©ë¡ (ê³µì§€ê¸€ë§Œ) -->
    <select id="listPaging" resultType="bndto">
    <![CDATA[
        SELECT *
        FROM (
            SELECT a.*, ROWNUM rnum
            FROM (
                SELECT 
                    bn.boardSeq,
                    bn.accountId,
                    ai.nickname,
                    bn.title,
                    bn.content,
                    TO_CHAR(bn.regdate, 'YYYY-MM-DD HH24:MI:SS') AS regdate,
                    bn.readCount,
                    bn.boardContentTypeSeq,
                    bn.attach
                FROM tblBoardNotice bn
				JOIN tblAccountInfo ai ON bn.accountId = ai.accountId
                ORDER BY boardSeq DESC
            ) a
            WHERE ROWNUM <= #{offset} + #{pageSize}
        )
        WHERE rnum > #{offset}
    ]]>
    </select>
    
    <!-- ðŸ”µ ì „ì²´ ê²Œì‹œë¬¼ ìˆ˜ (ê³µì§€ê¸€ë§Œ ì¹´ìš´íŠ¸) -->
    <select id="totalCount" resultType="int">
        SELECT COUNT(*)
        FROM tblBoardNotice
        WHERE boardContentTypeSeq = 2
    </select>

</mapper>
